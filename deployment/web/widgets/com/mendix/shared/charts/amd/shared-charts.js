define(["exports","react","./react-plotly","big.js"],(function(t,e,n,i){"use strict";function r(t){const e={};if(t.width&&(e.width="percentage"===t.widthUnit?`${t.width}%`:`${t.width}px`),t.height)if("percentageOfWidth"===t.heightUnit&&t.width){const n=t.height/100*t.width;"percentage"===t.widthUnit?(e.height="auto",e.paddingBottom=`${n}%`):e.height=`${n}px`}else"pixels"===t.heightUnit?e.height=`${t.height}px`:"percentageOfParent"===t.heightUnit&&(e.height=`${t.height}%`);return e}function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var a,s={exports:{}};
/*!
    	Copyright (c) 2018 Jed Watson.
    	Licensed under the MIT License (MIT), see
    	http://jedwatson.github.io/classnames
    */var u,c=(a||(a=1,u=s,function(){var t={}.hasOwnProperty;function e(){for(var n=[],i=0;i<arguments.length;i++){var r=arguments[i];if(r){var o=typeof r;if("string"===o||"number"===o)n.push(r);else if(Array.isArray(r)){if(r.length){var a=e.apply(null,r);a&&n.push(a)}}else if("object"===o){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){n.push(r.toString());continue}for(var s in r)t.call(r,s)&&r[s]&&n.push(s)}}}return n.join(" ")}u.exports?(e.default=e,u.exports=e):window.classNames=e}()),s.exports),l=o(c);function f(){const[t,n]=e.useMemo((()=>((t,e)=>{let n=null;const i=()=>{null!==n&&(clearTimeout(n),n=null)};return[(...r)=>{i(),n=setTimeout((()=>t(...r)),e)},i]})((t=>{window.dispatchEvent(new Event("resize"))}),100)),[]);return e.useEffect((()=>n),[n]),function(t){const n=e.useRef(null);return e.useLayoutEffect((()=>{const e=n?.current;if(!e)return;const i=new ResizeObserver((n=>{t(e,n[0])}));return i.observe(e),()=>{i.disconnect()}}),[t,n]),n}(t)}var h,d;var g=function(){if(d)return h;d=1;var t=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var n=Object.prototype.toString.call(t);return"[object RegExp]"===n||"[object Date]"===n||function(t){return t.$$typeof===e}(t)}(t)},e="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function n(t,e){return!1!==e.clone&&e.isMergeableObject(t)?s((n=t,Array.isArray(n)?[]:{}),t,e):t;var n}function i(t,e,i){return t.concat(e).map((function(t){return n(t,i)}))}function r(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return Object.propertyIsEnumerable.call(t,e)})):[]}(t))}function o(t,e){try{return e in t}catch(t){return!1}}function a(t,e,i){var a={};return i.isMergeableObject(t)&&r(t).forEach((function(e){a[e]=n(t[e],i)})),r(e).forEach((function(r){(function(t,e){return o(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,r)||(o(t,r)&&i.isMergeableObject(e[r])?a[r]=function(t,e){if(!e.customMerge)return s;var n=e.customMerge(t);return"function"==typeof n?n:s}(r,i)(t[r],e[r],i):a[r]=n(e[r],i))})),a}function s(e,r,o){(o=o||{}).arrayMerge=o.arrayMerge||i,o.isMergeableObject=o.isMergeableObject||t,o.cloneUnlessOtherwiseSpecified=n;var s=Array.isArray(r);return s===Array.isArray(e)?s?o.arrayMerge(e,r,o):a(e,r,o):n(r,o)}return s.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,n){return s(t,n,e)}),{})},h=s}(),m=o(g);const p={layout:{font:{family:"Open Sans",size:14,color:"#555"},autosize:!0,hovermode:"closest",hoverlabel:{bgcolor:"#888",bordercolor:"#888",font:{color:"#FFF"}},margin:{l:60,r:60,b:60,t:60,pad:10}},configuration:{displayModeBar:!1,doubleClick:!1},series:{connectgaps:!0,hoverinfo:"none",hoveron:"points"}},y=(...t)=>m.all([p.layout,...t]),b=(...t)=>m.all([p.configuration,...t]),w=(...t)=>m.all([p.series,...t]),v=({showLegend:t,xAxisLabel:e,gridLinesMode:n,yAxisLabel:i})=>({showlegend:t,xaxis:{title:{text:e},showgrid:"both"===n||"vertical"===n},yaxis:{title:{text:i},showgrid:"both"===n||"horizontal"===n}});function O(t){console.warn(`Error in theme folder configuration file: ${t}`)}const S=(t,n)=>{const[i,r]=e.useState({layout:{},configuration:{},series:{}});return e.useEffect((()=>{n&&async function(){try{const e=await async function(){try{if(!window)return null;const t=await window.fetch(`${window.mx.remoteUrl}com.mendix.charts.json`);if(t.ok)return await t.json()}catch(t){return null}}();if(null==e)return;if(!(e instanceof Object))return void O("invalid json object");if(!e.layout&&!e.configuration&&!e.charts)return void O("no 'layout', 'configuration', or 'charts' property found");r((n=>({configuration:e.configuration||n.configuration,layout:e.layout||n.layout,series:e.charts?.[t]||n.series})))}catch(t){O(t)}}()}),[t,n]),i},x=Symbol.for("ChartsPlaygroundContext");function j(){return window[x]??=e.createContext(null)}function A(){const t=e.useContext(j());return null===t?{error:new Error("Out of context: component is out of playground slot.")}:{data:t}}class E{listeners=[];state={layout:"{}",config:"{}",data:[]};set(...t){let e=!1;if("number"==typeof t[0])e=this.setData(...t);else{const[n,i]=t;e=this.setProp(n,i)}e&&this.emit()}addListener(t){return this.listeners.push(t),()=>this.listeners=this.listeners.filter((e=>e!==t))}resetData(t=0){this.state.data=Array(t).fill("{}"),this.emit()}reset(t){this.state={...t,data:[...t.data]},this.emit()}setData(t,e){let n=!1;return this.state.data[t]!==e&&(this.state={...this.state,data:this.state.data.map(((n,i)=>t===i?e:n))},n=!0),n}setProp(t,e){let n=!1;return this.state[t]!==e&&(this.state={...this.state,[t]:e},n=!0),n}emit(){this.listeners.forEach((t=>t()))}}function V(t){return""===t||void 0===t?"{}":t}function M(t){try{t=JSON.stringify(JSON.parse(t),null,2)}catch{console.warn("Failed to prettify json value.")}return t}function L(t){const[,n]=e.useReducer((t=>t+1),0),[i]=e.useState((()=>{const e=new E;return t.initState&&e.reset(t.initState()),e.addListener(n),e}));return e.useEffect((()=>()=>{i.resetData(t.dataLength)}),[i,t.dataLength]),i}function C(t,n){const{playgroundOn:i}=n,r=L({dataLength:t.data.length,initState:k(t)}),o=function(t,n){return e.useMemo((()=>({store:n,layoutOptions:t.layoutOptions,configOptions:t.configOptions,plotData:t.data})),[t.layoutOptions,t.configOptions,t.data,n])}(t,r),{state:a}=r;return[t=e.useMemo((()=>!1===i?t:function(t,e){return{...t,customConfig:e.config,customLayout:e.layout,data:t.data.map(((t,n)=>({...t,customSeriesOptions:e.data[n]})))}}(t,a)),[i,t,a]),o]}function k(t){return()=>({layout:M(V(t.customLayout)),config:M(V(t.customConfig)),data:t.data.map((t=>M(V(t.customSeriesOptions))))})}const N={},T=({data:t,configOptions:i,layoutOptions:r,seriesOptions:o,customConfig:a,customLayout:s})=>{const u=e.useMemo((()=>m(r,U(s))),[r,s]),c=e.useMemo((()=>m(i,U(a))),[i,a]),l=e.useMemo((()=>{return e=o,t.map((t=>{const n={...t},i=U(n.customSeriesOptions);return delete n.customSeriesOptions,delete n.dataSourceItems,m.all([e,n,i],{arrayMerge:(t,e)=>{const n=t.filter((t=>void 0!==t)),i=e.filter((t=>void 0!==t));return m(n,i)}})}));var e}),[t,o]),f=e.useCallback((e=>{const[{curveNumber:n,pointIndex:i,pointIndices:r,pointNumber:o,pointNumbers:a}]=e.points,s=function(t,e){const n=t??e?.at(-1);if("number"!=typeof n)throw new Error("Unable to get item index for given point.");return n}(i??o,r??a),{dataSourceItems:u,onClick:c}=t[n],l=u[s];c?.(l)}),[t]);return function(t){const n=e.useRef(!1);e.useEffect((()=>{!n.current&&t.length>0&&(window.dispatchEvent(new Event("resize")),n.current=!0)}),[t])}(t),e.createElement(n,{className:"mx-react-plotly-chart",data:l,style:N,config:c,layout:u,onClick:f})};function U(t){return JSON.parse(function(t){return function(t){return null!=t&&""!==t}(t)?t:"{}"}(t))}const P=j();function $(t){let n;return[t,n]=C(t,{playgroundOn:!!t.playground}),e.createElement(e.Fragment,null,e.createElement(T,{...t}),e.createElement(P.Provider,{value:n},t.playground))}function D(t,e="Did not expect an argument to be undefined"){if(null==t)throw new Error(e);return t}const F=t=>{t&&t.canExecute&&!t.isExecuting&&t.execute()};function I(t,e){if("none"===t)return e;const n=new Map,i=e.hovertext;e.x.forEach(((t,r)=>{const o=function(t){return null==t?"":"string"==typeof t||"number"==typeof t?t.toString():t.toISOString()}(t),a=e.y[r];if(null==a)return;let s=n.get(o);s||(s={yVals:[],hoverTexts:[]},n.set(o,s)),s.yVals.push(a),i&&i[r]&&s.hoverTexts.push(i[r])}));const r=[],o=[],a=[];for(const[e,{yVals:i,hoverTexts:s}]of n){r.push(e);const n=R(i,t);o.push(n);const u=i.length>1?n.toLocaleString():s[0];a.push(u)}const s=a.some((t=>void 0!==t&&""!==t));return{...e,x:r,y:o,hovertext:s?a:void 0,hoverinfo:s?"text":"none"}}function R(t,e){if(0===t.length)return NaN;switch(e){case"count":return t.length;case"sum":return t.reduce(((t,e)=>t+e),0);case"avg":return t.reduce(((t,e)=>t+e),0)/t.length;case"min":return Math.min(...t);case"max":return Math.max(...t);case"first":return t[0];case"last":return t[t.length-1];case"median":{const e=[...t].sort(((t,e)=>t-e)),n=Math.floor(e.length/2);return e.length%2==1?e[n]:(e[n-1]+e[n])/2}case"mode":{if(0===t.length)return NaN;const e=new Map;let n=0,i=t[0];for(const r of t){const t=(e.get(r)||0)+1;e.set(r,t),t>n&&(n=t,i=r)}return i}default:return console.warn(`Unknown aggregation type: ${e}`),NaN}}function B(t){return e=>F(t.get(e))}function H(t,e){const{staticName:n,dataSet:i,customSeriesOptions:r,staticOnClickAction:o}=t;if("static"!==i)throw Error("Expected series to be static");const a=_(t,n?.value);if(!a)return null;const s=t.aggregationType,u=s&&"none"!==s?I(s,a):a;return{...o?{onClick:B(o)}:void 0,...u,...e(t,u,Y),customSeriesOptions:r}}function z(t,e){const{dataSet:n,customSeriesOptions:r,dynamicOnClickAction:o}=t;if("dynamic"!==n)throw Error("Expected series to be dynamic");const a=function(t){const{dynamicDataSource:e,dynamicName:n,groupByAttribute:r,dataSet:o}=t;if("dynamic"!==o)throw Error("Expected series to be dynamic");const a=D(e);if(!a.items)return null;const s=[];for(const t of a.items){const e=D(r).get(t);if("loading"===e.status)return null;const o=e.value??"";let a=s.find((t=>o instanceof Date&&t.groupByAttributeValue instanceof Date?t.groupByAttributeValue.getTime()===o.getTime():o instanceof i&&t.groupByAttributeValue instanceof i?t.groupByAttributeValue.eq(o):t.groupByAttributeValue===o));if(a||(a={groupByAttributeValue:o,items:[]},s.push(a)),a.items.push(t),n&&(!a.dynamicNameValue||"(empty)"===a.dynamicNameValue)){const{status:e,value:i}=n.get(t);if("loading"===e)return null;a.dynamicNameValue=i??"(empty)"}}return s}(t);return a?a.map((n=>{const i=_(t,n.dynamicNameValue,n.items);if(!i)return null;const a=t.aggregationType,s=a&&"none"!==a?I(a,i):i;return{...o?{onClick:B(o)}:void 0,...s,...e(t,s,Y),customSeriesOptions:r}})).filter((t=>Boolean(t))):null}function _(t,e,n){const r="static"===t.dataSet?D(t.staticXAttribute):D(t.dynamicXAttribute),o="static"===t.dataSet?D(t.staticYAttribute):D(t.dynamicYAttribute);if(!n){const e=D(t.staticDataSource);if(!e.items)return null;n=e.items}const a=[],s=[],u=[];for(const e of n){const n=r.get(e),c=o.get(e);n.value?a.push(n.value instanceof i?n.value.toNumber():n.value):a.push(null),c.value?s.push(c.value instanceof i?c.value.toNumber():c.value):s.push(null);const l="dynamic"===t.dataSet?t.dynamicTooltipHoverText:t.staticTooltipHoverText;u.push(l?.get(e).value)}return{...e?{name:e}:{},x:a,y:s,dataSourceItems:n,hovertext:u.some((t=>void 0!==t&&""!==t))?u:void 0,hoverinfo:u.some((t=>void 0!==t&&""!==t))?"text":"none"}}const Y={getExpressionValue(t,e){for(const n of e){const e=t.get(n);return"available"!==e.status?void 0:e.value}}},q=t=>t instanceof Date,W=t=>t instanceof i,X=(t,e)=>t.localeCompare(e);function J(t,e){return(n,i)=>t(i)?e(n,i):void 0===i?-1:0}const K={string:J((t=>"string"==typeof t),X),boolean:J((t=>"boolean"==typeof t),((t,e)=>X(t.toString(),e.toString()))),date:J(q,((t,e)=>{const n=t.getTime()-e.getTime();return n>0?1:n<0?-1:0})),big:J(W,((t,e)=>t.cmp(e))),undefined:(t,e)=>t===e?0:1};function G(t,e){return`${t}${"pixels"===e?"px":"percentageOfView"===e?"vh":"%"}`}const Q=Object.is;function Z(t){return"object"==typeof t&&null!==t}function tt(t,e,n=Q){if(Z(t)&&Z(e)){const i=new Set(Object.keys(t).concat(Object.keys(e)));for(const r of i)if(!n(t[r],e[r],r))return!1;return!0}return Q(t,e)}function et(t,e){return tt(t,e,((t,e,n)=>"staticOnClickAction"===n||"dynamicOnClickAction"===n||Q(t,e)))}const nt=Object.freeze({Available:"available",Unavailable:"unavailable",Loading:"loading"});var it;!function(t){t.Number="number",t.DateTime="datetime"}(it||(it={}));class rt{editableValue={value:void 0,displayValue:"",status:nt.Available,validation:void 0,readOnly:!1,formatter:{format:jest.fn((t=>`Formatted ${t}`)),parse:jest.fn(),withConfig:jest.fn((()=>(new rt).build().formatter)),getFormatPlaceholder:jest.fn(),type:it.DateTime,config:{}},setValidator:jest.fn(),setValue:jest.fn((t=>this.withValue(t))),setTextValue:jest.fn(),setFormatter:jest.fn(),isList:!1};withValue(t){return this.editableValue.value=t,this.editableValue.displayValue=this.editableValue.formatter.format(t),this}withFormatter(t){return this.editableValue.formatter=t,this}isReadOnly(){return this.editableValue.readOnly=!0,this}isLoading(){return this.editableValue.status=nt.Loading,this.isReadOnly()}isUnavailable(){return this.editableValue.status=nt.Unavailable,this.isReadOnly()}withValidation(t){return this.editableValue.validation=t,this}withUniverse(...t){return this.editableValue.universe=t,this}build(){return this.editableValue}}class ot{listAttribute={id:"",get:jest.fn(),sortable:!0,filterable:!0,type:"String",formatter:{format:jest.fn((t=>t.toString())),parse:jest.fn()},universe:void 0};withId(t){return this.listAttribute.id=t,this}withSortable(t){return this.listAttribute.sortable=t,this}withFilterable(t){return this.listAttribute.filterable=t,this}withType(t){return this.listAttribute.type=t,this}withFormatter(t,e){return this.listAttribute.formatter={format:t,parse:e},this}withUniverse(t){return this.listAttribute.universe=t,this}build(){return this.listAttribute}}function at(t=function(t=4){return Math.random().toString(16).slice(2,2+t)}()){return{id:t=`obj_${t}`}}class st{mock;constructor(){this.mock={status:nt.Available,offset:0,limit:2,items:[at(),at()],totalCount:2,hasMoreItems:!1,setLimit:jest.fn(),setOffset:jest.fn(),requestTotalCount:jest.fn(),sortOrder:[],filter:void 0,setSortOrder:jest.fn(),setFilter:jest.fn(),reload:jest.fn()}}withItems(t){return this.mock.items=t,this.mock.totalCount=t.length,this.mock.limit=t.length,this}withSize(t){return this.withItems(function(t=1){return t=Math.floor(t),Array.from({length:t},at)}(t)),this}withHasMore(t){return this.mock.hasMoreItems=t,this}isLoading(){return this.mock.status=nt.Loading,this.mock.items=void 0,this}isUnavailable(){return this.mock.status=nt.Loading,this.mock.items=void 0,this}build(){return{...this.mock}}}function ut(t){let e=new st;return e=Array.isArray(t)?e.withItems(t):e.withSize(t),e.build()}ut.loading=()=>(new st).isLoading().build();const ct={usePlaygroundContext:A};t.ChartWidget=({className:t,data:n,widthUnit:i,width:o,heightUnit:a,height:s,showLegend:u,xAxisLabel:c,yAxisLabel:h,gridLinesMode:d,customLayout:g,customConfig:m,layoutOptions:p,configOptions:O,seriesOptions:x,type:j,enableThemeConfig:A,playground:E})=>{const V=S(j,A),M=e.useMemo((()=>y(v({showLegend:u,xAxisLabel:c,gridLinesMode:d,yAxisLabel:h}),p,V.layout)),[u,c,d,h,p,V.layout]),L=e.useMemo((()=>b(O,V.configuration)),[O,V.configuration]),C=e.useMemo((()=>w(x,V.series)),[x,V.series]),k=f();return 0===n.length?e.createElement(e.Fragment,null):e.createElement("div",{className:l("widget-chart",t),style:r({widthUnit:i,width:o,heightUnit:a,height:s}),ref:k},e.createElement($,{key:n.length,data:n,layoutOptions:M,customLayout:g,configOptions:L,customConfig:m,seriesOptions:C,playground:E}))},t.USE_ONLY_TO_KEEP_EXPORTS=ct,t.compareAttrValuesAsc=function(t,e){switch(typeof t){case"string":return K.string(t,e);case"boolean":return K.boolean(t,e);case"undefined":return K.undefined(t,e);default:return q(t)?K.date(t,e):W(t)?K.big(t,e):0}},t.constructWrapperStyle=function(t){const{widthUnit:e,heightUnit:n,minHeightUnit:i,maxHeightUnit:r,width:o,height:a,minHeight:s,maxHeight:u,OverflowY:c}=t,l={};return l.width=`${o}${"pixels"===e?"px":"%"}`,"percentageOfWidth"===n?(l.height="auto","none"!==i&&(l.minHeight=G(s,i)),"none"!==r&&(l.maxHeight=G(u,r),l.overflowY=c)):l.height=G(a,n),l},t.containerPropsEqual=function(t,e){return tt(t,e,((t,e,n)=>"series"===n?tt(t,e,et):Q(t,e)))},t.defaultConfigs=p,t.fallback=V,t.getCustomLayoutOptions=v,t.getModelerConfigOptions=b,t.getModelerLayoutOptions=y,t.getModelerSeriesOptions=w,t.getPlaygroundContext=j,t.initStateFromProps=function(t){return()=>({layout:M(V("")),config:M(V("")),data:t.map((t=>M(V(t.name))))})},t.mapperHelpers=Y,t.pprint=M,t.setupBasicSeries=function(t){const e=(new ot).build(),n=jest.fn();n.mockReturnValueOnce((new rt).withValue(new i(1)).build()),n.mockReturnValueOnce((new rt).withValue(new i(2)).build()),e.get=n;const r=(new ot).build(),o=jest.fn();return o.mockReturnValueOnce((new rt).withValue(new i(3)).build()),o.mockReturnValueOnce((new rt).withValue(new i(6)).build()),r.get=o,{dataSet:"static",customSeriesOptions:t.customSeriesOptions??"",aggregationType:t.aggregationType??"avg",staticDataSource:ut(2),staticXAttribute:e,staticYAttribute:r}},t.traceEqual=et,t.useEditorStore=L,t.usePlaygroundContext=A,t.usePlotChartDataSeries=function(t,n){const[i,r]=e.useState(null);return e.useEffect((()=>{const e=t.map((t=>("static"===t.dataSet?H:z)(t,n))).filter((t=>Boolean(t))).flat();r(0===e.length?null:e)}),[t,n]),i},t.useThemeFolderConfigs=S}));
