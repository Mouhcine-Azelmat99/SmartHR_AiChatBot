import{useMemo as t,useEffect as e,useRef as n,useLayoutEffect as i,useState as r,createContext as o,useContext as a,useReducer as s,useCallback as u,createElement as c,Fragment as l}from"react";import f from"./react-plotly.mjs";import h from"big.js";function d(t){const e={};if(t.width&&(e.width="percentage"===t.widthUnit?`${t.width}%`:`${t.width}px`),t.height)if("percentageOfWidth"===t.heightUnit&&t.width){const n=t.height/100*t.width;"percentage"===t.widthUnit?(e.height="auto",e.paddingBottom=`${n}%`):e.height=`${n}px`}else"pixels"===t.heightUnit?e.height=`${t.height}px`:"percentageOfParent"===t.heightUnit&&(e.height=`${t.height}%`);return e}function g(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var m,p={exports:{}};
/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var y,b=(m||(m=1,y=p,function(){var t={}.hasOwnProperty;function e(){for(var n=[],i=0;i<arguments.length;i++){var r=arguments[i];if(r){var o=typeof r;if("string"===o||"number"===o)n.push(r);else if(Array.isArray(r)){if(r.length){var a=e.apply(null,r);a&&n.push(a)}}else if("object"===o){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){n.push(r.toString());continue}for(var s in r)t.call(r,s)&&r[s]&&n.push(s)}}}return n.join(" ")}y.exports?(e.default=e,y.exports=e):window.classNames=e}()),p.exports),w=g(b);function v(){const[r,o]=t((()=>((t,e)=>{let n=null;const i=()=>{null!==n&&(clearTimeout(n),n=null)};return[(...r)=>{i(),n=setTimeout((()=>t(...r)),e)},i]})((t=>{window.dispatchEvent(new Event("resize"))}),100)),[]);return e((()=>o),[o]),function(t){const e=n(null);return i((()=>{const n=e?.current;if(!n)return;const i=new ResizeObserver((e=>{t(n,e[0])}));return i.observe(n),()=>{i.disconnect()}}),[t,e]),e}(r)}var O,x;var S=function(){if(x)return O;x=1;var t=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var n=Object.prototype.toString.call(t);return"[object RegExp]"===n||"[object Date]"===n||function(t){return t.$$typeof===e}(t)}(t)},e="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function n(t,e){return!1!==e.clone&&e.isMergeableObject(t)?s((n=t,Array.isArray(n)?[]:{}),t,e):t;var n}function i(t,e,i){return t.concat(e).map((function(t){return n(t,i)}))}function r(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return Object.propertyIsEnumerable.call(t,e)})):[]}(t))}function o(t,e){try{return e in t}catch(t){return!1}}function a(t,e,i){var a={};return i.isMergeableObject(t)&&r(t).forEach((function(e){a[e]=n(t[e],i)})),r(e).forEach((function(r){(function(t,e){return o(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,r)||(o(t,r)&&i.isMergeableObject(e[r])?a[r]=function(t,e){if(!e.customMerge)return s;var n=e.customMerge(t);return"function"==typeof n?n:s}(r,i)(t[r],e[r],i):a[r]=n(e[r],i))})),a}function s(e,r,o){(o=o||{}).arrayMerge=o.arrayMerge||i,o.isMergeableObject=o.isMergeableObject||t,o.cloneUnlessOtherwiseSpecified=n;var s=Array.isArray(r);return s===Array.isArray(e)?s?o.arrayMerge(e,r,o):a(e,r,o):n(r,o)}return s.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,n){return s(t,n,e)}),{})},O=s}(),j=g(S);const A={layout:{font:{family:"Open Sans",size:14,color:"#555"},autosize:!0,hovermode:"closest",hoverlabel:{bgcolor:"#888",bordercolor:"#888",font:{color:"#FFF"}},margin:{l:60,r:60,b:60,t:60,pad:10}},configuration:{displayModeBar:!1,doubleClick:!1},series:{connectgaps:!0,hoverinfo:"none",hoveron:"points"}},V=(...t)=>j.all([A.layout,...t]),L=(...t)=>j.all([A.configuration,...t]),k=(...t)=>j.all([A.series,...t]),M=({showLegend:t,xAxisLabel:e,gridLinesMode:n,yAxisLabel:i})=>({showlegend:t,xaxis:{title:{text:e},showgrid:"both"===n||"vertical"===n},yaxis:{title:{text:i},showgrid:"both"===n||"horizontal"===n}});function E(t){console.warn(`Error in theme folder configuration file: ${t}`)}const N=(t,n)=>{const[i,o]=r({layout:{},configuration:{},series:{}});return e((()=>{n&&async function(){try{const e=await async function(){try{if(!window)return null;const t=await window.fetch(`${window.mx.remoteUrl}com.mendix.charts.json`);if(t.ok)return await t.json()}catch(t){return null}}();if(null==e)return;if(!(e instanceof Object))return void E("invalid json object");if(!e.layout&&!e.configuration&&!e.charts)return void E("no 'layout', 'configuration', or 'charts' property found");o((n=>({configuration:e.configuration||n.configuration,layout:e.layout||n.layout,series:e.charts?.[t]||n.series})))}catch(t){E(t)}}()}),[t,n]),i},C=Symbol.for("ChartsPlaygroundContext");function T(){return window[C]??=o(null)}function U(){const t=a(T());return null===t?{error:new Error("Out of context: component is out of playground slot.")}:{data:t}}class ${listeners=[];state={layout:"{}",config:"{}",data:[]};set(...t){let e=!1;if("number"==typeof t[0])e=this.setData(...t);else{const[n,i]=t;e=this.setProp(n,i)}e&&this.emit()}addListener(t){return this.listeners.push(t),()=>this.listeners=this.listeners.filter((e=>e!==t))}resetData(t=0){this.state.data=Array(t).fill("{}"),this.emit()}reset(t){this.state={...t,data:[...t.data]},this.emit()}setData(t,e){let n=!1;return this.state.data[t]!==e&&(this.state={...this.state,data:this.state.data.map(((n,i)=>t===i?e:n))},n=!0),n}setProp(t,e){let n=!1;return this.state[t]!==e&&(this.state={...this.state,[t]:e},n=!0),n}emit(){this.listeners.forEach((t=>t()))}}function D(t){return""===t||void 0===t?"{}":t}function I(t){try{t=JSON.stringify(JSON.parse(t),null,2)}catch{console.warn("Failed to prettify json value.")}return t}function P(t){const[,n]=s((t=>t+1),0),[i]=r((()=>{const e=new $;return t.initState&&e.reset(t.initState()),e.addListener(n),e}));return e((()=>()=>{i.resetData(t.dataLength)}),[i,t.dataLength]),i}function F(t){return()=>({layout:I(D("")),config:I(D("")),data:t.map((t=>I(D(t.name))))})}function B(e,n){const{playgroundOn:i}=n,r=P({dataLength:e.data.length,initState:z(e)}),o=function(e,n){return t((()=>({store:n,layoutOptions:e.layoutOptions,configOptions:e.configOptions,plotData:e.data})),[e.layoutOptions,e.configOptions,e.data,n])}(e,r),{state:a}=r;return[e=t((()=>!1===i?e:function(t,e){return{...t,customConfig:e.config,customLayout:e.layout,data:t.data.map(((t,n)=>({...t,customSeriesOptions:e.data[n]})))}}(e,a)),[i,e,a]),o]}function z(t){return()=>({layout:I(D(t.customLayout)),config:I(D(t.customConfig)),data:t.data.map((t=>I(D(t.customSeriesOptions))))})}const H={},R=({data:i,configOptions:r,layoutOptions:o,seriesOptions:a,customConfig:s,customLayout:l})=>{const h=t((()=>j(o,Y(l))),[o,l]),d=t((()=>j(r,Y(s))),[r,s]),g=t((()=>{return t=a,i.map((e=>{const n={...e},i=Y(n.customSeriesOptions);return delete n.customSeriesOptions,delete n.dataSourceItems,j.all([t,n,i],{arrayMerge:(t,e)=>{const n=t.filter((t=>void 0!==t)),i=e.filter((t=>void 0!==t));return j(n,i)}})}));var t}),[i,a]),m=u((t=>{const[{curveNumber:e,pointIndex:n,pointIndices:r,pointNumber:o,pointNumbers:a}]=t.points,s=function(t,e){const n=t??e?.at(-1);if("number"!=typeof n)throw new Error("Unable to get item index for given point.");return n}(n??o,r??a),{dataSourceItems:u,onClick:c}=i[e],l=u[s];c?.(l)}),[i]);return function(t){const i=n(!1);e((()=>{!i.current&&t.length>0&&(window.dispatchEvent(new Event("resize")),i.current=!0)}),[t])}(i),c(f,{className:"mx-react-plotly-chart",data:g,style:H,config:d,layout:h,onClick:m})};function Y(t){return JSON.parse(function(t){return function(t){return null!=t&&""!==t}(t)?t:"{}"}(t))}const J=T();function X(t){let e;return[t,e]=B(t,{playgroundOn:!!t.playground}),c(l,null,c(R,{...t}),c(J.Provider,{value:e},t.playground))}const _=({className:e,data:n,widthUnit:i,width:r,heightUnit:o,height:a,showLegend:s,xAxisLabel:u,yAxisLabel:f,gridLinesMode:h,customLayout:g,customConfig:m,layoutOptions:p,configOptions:y,seriesOptions:b,type:O,enableThemeConfig:x,playground:S})=>{const j=N(O,x),A=t((()=>V(M({showLegend:s,xAxisLabel:u,gridLinesMode:h,yAxisLabel:f}),p,j.layout)),[s,u,h,f,p,j.layout]),E=t((()=>L(y,j.configuration)),[y,j.configuration]),C=t((()=>k(b,j.series)),[b,j.series]),T=v();return 0===n.length?c(l,null):c("div",{className:w("widget-chart",e),style:d({widthUnit:i,width:r,heightUnit:o,height:a}),ref:T},c(X,{key:n.length,data:n,layoutOptions:A,customLayout:g,configOptions:E,customConfig:m,seriesOptions:C,playground:S}))};function q(t,e="Did not expect an argument to be undefined"){if(null==t)throw new Error(e);return t}const W=t=>{t&&t.canExecute&&!t.isExecuting&&t.execute()};function G(t,e){if("none"===t)return e;const n=new Map,i=e.hovertext;e.x.forEach(((t,r)=>{const o=function(t){return null==t?"":"string"==typeof t||"number"==typeof t?t.toString():t.toISOString()}(t),a=e.y[r];if(null==a)return;let s=n.get(o);s||(s={yVals:[],hoverTexts:[]},n.set(o,s)),s.yVals.push(a),i&&i[r]&&s.hoverTexts.push(i[r])}));const r=[],o=[],a=[];for(const[e,{yVals:i,hoverTexts:s}]of n){r.push(e);const n=K(i,t);o.push(n);const u=i.length>1?n.toLocaleString():s[0];a.push(u)}const s=a.some((t=>void 0!==t&&""!==t));return{...e,x:r,y:o,hovertext:s?a:void 0,hoverinfo:s?"text":"none"}}function K(t,e){if(0===t.length)return NaN;switch(e){case"count":return t.length;case"sum":return t.reduce(((t,e)=>t+e),0);case"avg":return t.reduce(((t,e)=>t+e),0)/t.length;case"min":return Math.min(...t);case"max":return Math.max(...t);case"first":return t[0];case"last":return t[t.length-1];case"median":{const e=[...t].sort(((t,e)=>t-e)),n=Math.floor(e.length/2);return e.length%2==1?e[n]:(e[n-1]+e[n])/2}case"mode":{if(0===t.length)return NaN;const e=new Map;let n=0,i=t[0];for(const r of t){const t=(e.get(r)||0)+1;e.set(r,t),t>n&&(n=t,i=r)}return i}default:return console.warn(`Unknown aggregation type: ${e}`),NaN}}function Q(t,n){const[i,o]=r(null);return e((()=>{const e=t.map((t=>("static"===t.dataSet?tt:et)(t,n))).filter((t=>Boolean(t))).flat();o(0===e.length?null:e)}),[t,n]),i}function Z(t){return e=>W(t.get(e))}function tt(t,e){const{staticName:n,dataSet:i,customSeriesOptions:r,staticOnClickAction:o}=t;if("static"!==i)throw Error("Expected series to be static");const a=nt(t,n?.value);if(!a)return null;const s=t.aggregationType,u=s&&"none"!==s?G(s,a):a;return{...o?{onClick:Z(o)}:void 0,...u,...e(t,u,it),customSeriesOptions:r}}function et(t,e){const{dataSet:n,customSeriesOptions:i,dynamicOnClickAction:r}=t;if("dynamic"!==n)throw Error("Expected series to be dynamic");const o=function(t){const{dynamicDataSource:e,dynamicName:n,groupByAttribute:i,dataSet:r}=t;if("dynamic"!==r)throw Error("Expected series to be dynamic");const o=q(e);if(!o.items)return null;const a=[];for(const t of o.items){const e=q(i).get(t);if("loading"===e.status)return null;const r=e.value??"";let o=a.find((t=>r instanceof Date&&t.groupByAttributeValue instanceof Date?t.groupByAttributeValue.getTime()===r.getTime():r instanceof h&&t.groupByAttributeValue instanceof h?t.groupByAttributeValue.eq(r):t.groupByAttributeValue===r));if(o||(o={groupByAttributeValue:r,items:[]},a.push(o)),o.items.push(t),n&&(!o.dynamicNameValue||"(empty)"===o.dynamicNameValue)){const{status:e,value:i}=n.get(t);if("loading"===e)return null;o.dynamicNameValue=i??"(empty)"}}return a}(t);return o?o.map((n=>{const o=nt(t,n.dynamicNameValue,n.items);if(!o)return null;const a=t.aggregationType,s=a&&"none"!==a?G(a,o):o;return{...r?{onClick:Z(r)}:void 0,...s,...e(t,s,it),customSeriesOptions:i}})).filter((t=>Boolean(t))):null}function nt(t,e,n){const i="static"===t.dataSet?q(t.staticXAttribute):q(t.dynamicXAttribute),r="static"===t.dataSet?q(t.staticYAttribute):q(t.dynamicYAttribute);if(!n){const e=q(t.staticDataSource);if(!e.items)return null;n=e.items}const o=[],a=[],s=[];for(const e of n){const n=i.get(e),u=r.get(e);n.value?o.push(n.value instanceof h?n.value.toNumber():n.value):o.push(null),u.value?a.push(u.value instanceof h?u.value.toNumber():u.value):a.push(null);const c="dynamic"===t.dataSet?t.dynamicTooltipHoverText:t.staticTooltipHoverText;s.push(c?.get(e).value)}return{...e?{name:e}:{},x:o,y:a,dataSourceItems:n,hovertext:s.some((t=>void 0!==t&&""!==t))?s:void 0,hoverinfo:s.some((t=>void 0!==t&&""!==t))?"text":"none"}}const it={getExpressionValue(t,e){for(const n of e){const e=t.get(n);return"available"!==e.status?void 0:e.value}}},rt=t=>t instanceof Date,ot=t=>t instanceof h,at=(t,e)=>t.localeCompare(e);function st(t,e){return(n,i)=>t(i)?e(n,i):void 0===i?-1:0}const ut={string:st((t=>"string"==typeof t),at),boolean:st((t=>"boolean"==typeof t),((t,e)=>at(t.toString(),e.toString()))),date:st(rt,((t,e)=>{const n=t.getTime()-e.getTime();return n>0?1:n<0?-1:0})),big:st(ot,((t,e)=>t.cmp(e))),undefined:(t,e)=>t===e?0:1};function ct(t,e){switch(typeof t){case"string":return ut.string(t,e);case"boolean":return ut.boolean(t,e);case"undefined":return ut.undefined(t,e);default:return rt(t)?ut.date(t,e):ot(t)?ut.big(t,e):0}}function lt(t,e){return`${t}${"pixels"===e?"px":"percentageOfView"===e?"vh":"%"}`}function ft(t){const{widthUnit:e,heightUnit:n,minHeightUnit:i,maxHeightUnit:r,width:o,height:a,minHeight:s,maxHeight:u,OverflowY:c}=t,l={};return l.width=`${o}${"pixels"===e?"px":"%"}`,"percentageOfWidth"===n?(l.height="auto","none"!==i&&(l.minHeight=lt(s,i)),"none"!==r&&(l.maxHeight=lt(u,r),l.overflowY=c)):l.height=lt(a,n),l}const ht=Object.is;function dt(t){return"object"==typeof t&&null!==t}function gt(t,e,n=ht){if(dt(t)&&dt(e)){const i=new Set(Object.keys(t).concat(Object.keys(e)));for(const r of i)if(!n(t[r],e[r],r))return!1;return!0}return ht(t,e)}function mt(t,e){return gt(t,e,((t,e,n)=>"staticOnClickAction"===n||"dynamicOnClickAction"===n||ht(t,e)))}function pt(t,e){return gt(t,e,((t,e,n)=>"series"===n?gt(t,e,mt):ht(t,e)))}const yt=Object.freeze({Available:"available",Unavailable:"unavailable",Loading:"loading"});var bt;!function(t){t.Number="number",t.DateTime="datetime"}(bt||(bt={}));class wt{editableValue={value:void 0,displayValue:"",status:yt.Available,validation:void 0,readOnly:!1,formatter:{format:jest.fn((t=>`Formatted ${t}`)),parse:jest.fn(),withConfig:jest.fn((()=>(new wt).build().formatter)),getFormatPlaceholder:jest.fn(),type:bt.DateTime,config:{}},setValidator:jest.fn(),setValue:jest.fn((t=>this.withValue(t))),setTextValue:jest.fn(),setFormatter:jest.fn(),isList:!1};withValue(t){return this.editableValue.value=t,this.editableValue.displayValue=this.editableValue.formatter.format(t),this}withFormatter(t){return this.editableValue.formatter=t,this}isReadOnly(){return this.editableValue.readOnly=!0,this}isLoading(){return this.editableValue.status=yt.Loading,this.isReadOnly()}isUnavailable(){return this.editableValue.status=yt.Unavailable,this.isReadOnly()}withValidation(t){return this.editableValue.validation=t,this}withUniverse(...t){return this.editableValue.universe=t,this}build(){return this.editableValue}}class vt{listAttribute={id:"",get:jest.fn(),sortable:!0,filterable:!0,type:"String",formatter:{format:jest.fn((t=>t.toString())),parse:jest.fn()},universe:void 0};withId(t){return this.listAttribute.id=t,this}withSortable(t){return this.listAttribute.sortable=t,this}withFilterable(t){return this.listAttribute.filterable=t,this}withType(t){return this.listAttribute.type=t,this}withFormatter(t,e){return this.listAttribute.formatter={format:t,parse:e},this}withUniverse(t){return this.listAttribute.universe=t,this}build(){return this.listAttribute}}function Ot(t=function(t=4){return Math.random().toString(16).slice(2,2+t)}()){return{id:t=`obj_${t}`}}class xt{mock;constructor(){this.mock={status:yt.Available,offset:0,limit:2,items:[Ot(),Ot()],totalCount:2,hasMoreItems:!1,setLimit:jest.fn(),setOffset:jest.fn(),requestTotalCount:jest.fn(),sortOrder:[],filter:void 0,setSortOrder:jest.fn(),setFilter:jest.fn(),reload:jest.fn()}}withItems(t){return this.mock.items=t,this.mock.totalCount=t.length,this.mock.limit=t.length,this}withSize(t){return this.withItems(function(t=1){return t=Math.floor(t),Array.from({length:t},Ot)}(t)),this}withHasMore(t){return this.mock.hasMoreItems=t,this}isLoading(){return this.mock.status=yt.Loading,this.mock.items=void 0,this}isUnavailable(){return this.mock.status=yt.Loading,this.mock.items=void 0,this}build(){return{...this.mock}}}function St(t){let e=new xt;return e=Array.isArray(t)?e.withItems(t):e.withSize(t),e.build()}function jt(t){const e=(new vt).build(),n=jest.fn();n.mockReturnValueOnce((new wt).withValue(new h(1)).build()),n.mockReturnValueOnce((new wt).withValue(new h(2)).build()),e.get=n;const i=(new vt).build(),r=jest.fn();return r.mockReturnValueOnce((new wt).withValue(new h(3)).build()),r.mockReturnValueOnce((new wt).withValue(new h(6)).build()),i.get=r,{dataSet:"static",customSeriesOptions:t.customSeriesOptions??"",aggregationType:t.aggregationType??"avg",staticDataSource:St(2),staticXAttribute:e,staticYAttribute:i}}St.loading=()=>(new xt).isLoading().build();const At={usePlaygroundContext:U};export{_ as ChartWidget,At as USE_ONLY_TO_KEEP_EXPORTS,ct as compareAttrValuesAsc,ft as constructWrapperStyle,pt as containerPropsEqual,A as defaultConfigs,D as fallback,M as getCustomLayoutOptions,L as getModelerConfigOptions,V as getModelerLayoutOptions,k as getModelerSeriesOptions,T as getPlaygroundContext,F as initStateFromProps,it as mapperHelpers,I as pprint,jt as setupBasicSeries,mt as traceEqual,P as useEditorStore,U as usePlaygroundContext,Q as usePlotChartDataSeries,N as useThemeFolderConfigs};
