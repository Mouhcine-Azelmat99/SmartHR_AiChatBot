import{jsx as e,jsxs as n}from"react/jsx-runtime";import{useCallback as t,useMemo as r,useState as o,useRef as a,createContext as i,useContext as d,useEffect as c,useLayoutEffect as l}from"react";import{Icon as s}from"mendix/components/web/Icon";function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h,m={exports:{}};
/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var f,g=(h||(h=1,f=m,function(){var e={}.hasOwnProperty;function n(){for(var e="",n=0;n<arguments.length;n++){var o=arguments[n];o&&(e=r(e,t(o)))}return e}function t(t){if("string"==typeof t||"number"==typeof t)return t;if("object"!=typeof t)return"";if(Array.isArray(t))return n.apply(null,t);if(t.toString!==Object.prototype.toString&&!t.toString.toString().includes("[native code]"))return t.toString();var o="";for(var a in t)e.call(t,a)&&t[a]&&(o=r(o,a));return o}function r(e,n){return n?e?e+" "+n:e+n:e}f.exports?(n.default=n,f.exports=n):window.classNames=n}()),m.exports),v=u(g);const p={Enter:"Enter"," ":"Space",Home:"Home",End:"End",ArrowUp:"ArrowUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight"};const C=e=>t(n=>{var t;if(function(e){return e.currentTarget===e.target}(n)&&(t=n.key,Object.hasOwn(p,t))){const t=e[p[n.key]];if(!t)return;n.stopPropagation(),n.preventDefault(),t(n)}},[e]);const N=n=>{let{className:t}=n;return e("svg",{className:t,"aria-hidden":!0,width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M1.64598 4.64601C1.69242 4.59945 1.7476 4.5625 1.80834 4.5373C1.86909 4.51209 1.93421 4.49911 1.99998 4.49911C2.06575 4.49911 2.13087 4.51209 2.19161 4.5373C2.25236 4.5625 2.30753 4.59945 2.35398 4.64601L7.99998 10.293L13.646 4.64601C13.6925 4.59952 13.7477 4.56264 13.8084 4.53749C13.8691 4.51233 13.9342 4.49938 14 4.49938C14.0657 4.49938 14.1308 4.51233 14.1916 4.53749C14.2523 4.56264 14.3075 4.59952 14.354 4.64601C14.4005 4.6925 14.4373 4.74769 14.4625 4.80842C14.4877 4.86916 14.5006 4.93426 14.5006 5.00001C14.5006 5.06575 14.4877 5.13085 14.4625 5.19159C14.4373 5.25233 14.4005 5.30752 14.354 5.35401L8.35398 11.354C8.30753 11.4006 8.25236 11.4375 8.19161 11.4627C8.13087 11.4879 8.06575 11.5009 7.99998 11.5009C7.93421 11.5009 7.86909 11.4879 7.80834 11.4627C7.7476 11.4375 7.69242 11.4006 7.64598 11.354L1.64598 5.35401C1.59942 5.30756 1.56247 5.25239 1.53727 5.19164C1.51206 5.1309 1.49908 5.06578 1.49908 5.00001C1.49908 4.93424 1.51206 4.86912 1.53727 4.80837C1.56247 4.74763 1.59942 4.69245 1.64598 4.64601V4.64601Z"})})},I=n=>{let{icon:t}=n,r=t;return t&&"image"!==t.type&&(r={...t,iconClass:v(t.iconClass,"widget-tree-node-branch-header-icon")}),e(s,{icon:r})};const E=i({level:0,informParentOfChildNodes:()=>null}),w="widget-tree-node-body",A=e=>"".concat(e,"TreeNodeBranchHeader"),L=e=>"".concat(e,"TreeNodeBranchBody");function S(i){let{animateTreeNodeContent:s,changeFocus:u,children:h,headerContent:m,iconPlacement:f,id:g,isUserDefinedLeafNode:p,openNodeOn:N,renderHeaderIcon:I,startExpanded:S}=i;const{level:b}=d(E),D=a(null),T=a(null),[O,y]=o(p||!h),[P,x]=o(S?"EXPANDED":"COLLAPSED_WITH_JS"),{isAnimating:_,captureElementHeight:H,animateTreeNodeContent:R,cleanupAnimation:k}=(e=>{const n=a(void 0),[r,i]=o(!1);return{isAnimating:r,captureElementHeight:t(()=>{var t,r;n.current=null!==(t=null===(r=e.current)||void 0===r?void 0:r.getBoundingClientRect().height)&&void 0!==t?t:0},[]),animateTreeNodeContent:t(()=>{if(e.current&&void 0!==n.current&&!Number.isNaN(n.current)){const t=e.current.getBoundingClientRect().height;if(t-n.current!==0){i(!0),e.current.style.height="".concat(n.current,"px");const r=setTimeout(()=>{e.current.style.height="".concat(t,"px"),n.current=t},1);return()=>clearTimeout(r)}}},[]),cleanupAnimation:t(()=>{var n;i(!1),null===(n=e.current)||void 0===n||n.style.removeProperty("height")},[])}})(T),X=t(e=>{var n,t,r;const o=e.target;return!(null!==(n=D.current)&&void 0!==n&&n.isSameNode(o)||null!==(t=D.current)&&void 0!==t&&null!==(t=t.firstElementChild)&&void 0!==t&&t.contains(o)||null!==(r=D.current)&&void 0!==r&&null!==(r=r.lastElementChild)&&void 0!==r&&r.isSameNode(o))},[]),U=t(e=>{X(e)||O||(H(),x(e=>"LOADING"===e?e:"COLLAPSED_WITH_JS"===e?"LOADING":"COLLAPSED_WITH_CSS"===e?"EXPANDED":"COLLAPSED_WITH_CSS"))},[H,X,O]),W=((e,n,o,a,i)=>{const d=r(()=>({Enter:e,Space:e,Home:e=>n(e.currentTarget,"FIRST"),End:e=>n(e.currentTarget,"LAST"),ArrowUp:e=>n(e.currentTarget,"PREVIOUS","HORIZONTAL"),ArrowDown:e=>n(e.currentTarget,"NEXT","HORIZONTAL"),ArrowRight:t=>{"COLLAPSED_WITH_CSS"===o||"COLLAPSED_WITH_JS"===o?e(t):("EXPANDED"===o||a)&&n(t.currentTarget,"NEXT","VERTICAL")},ArrowLeft:t=>{"COLLAPSED_WITH_CSS"===o||"COLLAPSED_WITH_JS"===o||a?n(t.currentTarget,"PREVIOUS","VERTICAL"):"EXPANDED"===o&&e(t)}}),[e,n,o,a]),c=C(d);return t(e=>{if(!i(e))return c(e)},[i,c])})(U,u,P,O,X),B={"aria-expanded":"EXPANDED"===P,role:"treeitem",tabIndex:0};const V="iconClick"===N,G="headerClick"===N,j=V?U:void 0,J=G?U:void 0,{hasNestedTreeNode:F}=(e=>({hasNestedTreeNode:t(()=>{var n,t;return null===(n=null===(t=e.current)||void 0===t||null===(t=t.lastElementChild)||void 0===t?void 0:t.className.includes("widget-tree-node"))||void 0===n||n},[])}))(T);return l(()=>{if(s&&"LOADING"!==P){const e=R();if(e)return e}},[R,s,P]),c(()=>{y(p||!h)},[h,p]),c(()=>{"LOADING"===P&&(F()||x("EXPANDED"))},[F,P]),n("li",{className:"widget-tree-node-branch",onKeyDown:W,ref:D,...B,children:[n("span",{className:v("widget-tree-node-branch-header",{"widget-tree-node-branch-header-clickable":!O&&G,"widget-tree-node-branch-header-reversed":"left"===f}),id:A(g),onClick:J,children:[e("span",{className:"widget-tree-node-branch-header-value",children:m}),!O&&"no"!==f&&e("span",{className:v("widget-tree-node-branch-header-icon-container",{"widget-tree-node-branch-header-clickable":!O&&V}),onClick:j,children:I(P,f)})]}),(!O&&"COLLAPSED_WITH_JS"!==P||_)&&e(E.Provider,{value:{level:b+1,informParentOfChildNodes:e=>{void 0!==e&&(x(e=>"LOADING"===e?"EXPANDED":e),y(n=>0===e&&!n||!(e>0&&n)&&n))}},children:e("div",{className:v(w,{"widget-tree-node-branch-hidden":"COLLAPSED_WITH_CSS"===P&&!_,"widget-tree-node-branch-loading":"LOADING"===P}),id:L(g),"aria-hidden":"EXPANDED"!==P,ref:T,onTransitionEnd:k,children:h})})]})}function b(n){var r;let{class:a,items:i,style:l,isUserDefinedLeafNode:s,showCustomIcon:u,startExpanded:h,iconPlacement:m,expandedIcon:f,collapsedIcon:g,tabIndex:p,animateIcon:C,animateTreeNodeContent:A,openNodeOn:L}=n;const{level:b}=d(E),[D,T]=function(){const[e,n]=o(null);return[e,t(e=>{e&&n(e)},[])]}(),O=t((n,t)=>function(n,t,r){if("LOADING"===n)return e("img",{src:"widgets/com/mendix/widget/web/treenode/assets/72df3b1b0b37a958.svg",className:"widget-tree-node-loading-spinner",alt:"","aria-hidden":!0});const{animateIcon:o,collapsedIcon:a,expandedIcon:i,showCustomIcon:d}=r,c="EXPANDED"===n;return d?e(I,{icon:c?i:a}):e(N,{className:v("widget-tree-node-branch-header-icon",{"widget-tree-node-branch-header-icon-animated":o,"widget-tree-node-branch-header-icon-collapsed-left":!c&&"left"===t,"widget-tree-node-branch-header-icon-collapsed-right":!c&&"right"===t})})}(n,t,{animateIcon:C,collapsedIcon:g,expandedIcon:f,showCustomIcon:u}),[g,f,u,C]),y=t(()=>{var e,n;return null!==(e=null==D||null===(n=D.parentElement)||void 0===n?void 0:n.className.includes(w))&&void 0!==e&&e},[D]);((e,n)=>{const{level:t,informParentOfChildNodes:r}=d(E);c(()=>{t>0&&n()&&r(e)},[n,r,t,e])})(null!==(r=null==i?void 0:i.length)&&void 0!==r?r:0,y);const P=t((e,n,t)=>{if(e&&e instanceof Element){const r=e=>{if(e){const n=Array.from(e.querySelectorAll("li.widget-tree-node-branch")),t=Array.from(e.querySelectorAll(".widget-tree-node-body[aria-hidden=true]"));return n.filter(e=>!t.some(n=>n.contains(e)))}return[]},o=Array.from(document.body.querySelectorAll(".widget-tree-node[role=tree]")).find(n=>n.contains(e));if(!o)return;const a=r(o),i=a.length;if(0===i)return;const d=a.findIndex(n=>n.isSameNode(e));switch(n){case"FIRST":a[0].focus();break;case"LAST":a[i-1].focus();break;case"PREVIOUS":{if("VERTICAL"===t){const n=r(document).filter(n=>{var t;return null===(t=n.lastElementChild)||void 0===t?void 0:t.contains(e)});return void(n.length>0&&n[n.length-1].focus())}const n=d-1,o=Math.max(n,0);o!==d&&a[o].focus();break}case"NEXT":{if("VERTICAL"===t){const n=r(e.lastElementChild);return void(n.length>0&&n[0].focus())}const n=d+1,o=Math.min(n,i-1);o!==d&&a[o].focus();break}}}},[]);return null===i||0===i.length?null:e("ul",{className:v("widget-tree-node",a),style:l,ref:T,"data-focusindex":p||0,role:0===b?"tree":"group",children:i.map(n=>{let{id:t,headerContent:r,bodyContent:o}=n;return e(S,{id:t,headerContent:r,isUserDefinedLeafNode:s,startExpanded:h,iconPlacement:m,renderHeaderIcon:O,changeFocus:P,animateTreeNodeContent:A,openNodeOn:L,children:o},t)})})}function D(n){var t,r;const{datasource:a}=n,[i,d]=o([]);c(()=>{"available"===a.status&&(a.items&&a.items.length?d(a.items.map(e=>function(e,n){var t,r,o;return{id:e.id,headerContent:"text"===n.headerType?null===(t=n.headerCaption)||void 0===t?void 0:t.get(e).value:null===(r=n.headerContent)||void 0===r?void 0:r.get(e),bodyContent:null===(o=n.children)||void 0===o?void 0:o.get(e)}}(e,n))):d([]))},[a.status,a.items]);const l="available"===(null===(t=n.expandedIcon)||void 0===t?void 0:t.status)?n.expandedIcon.value:void 0,s="available"===(null===(r=n.collapsedIcon)||void 0===r?void 0:r.status)?n.collapsedIcon.value:void 0;return e(b,{class:n.class,style:n.style,items:i,isUserDefinedLeafNode:!n.hasChildren,startExpanded:n.startExpanded,showCustomIcon:Boolean(n.expandedIcon)||Boolean(n.collapsedIcon),iconPlacement:n.showIcon,expandedIcon:l,collapsedIcon:s,tabIndex:n.tabIndex,animateIcon:n.animate&&n.animateIcon,animateTreeNodeContent:n.animate,openNodeOn:n.openNodeOn})}export{D as TreeNode};
